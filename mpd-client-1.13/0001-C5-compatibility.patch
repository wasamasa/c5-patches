From b1c11668af902bef085fd030cf0b2709503f6e57 Mon Sep 17 00:00:00 2001
From: Vasilij Schneidermann <mail@vasilij.de>
Date: Tue, 26 Mar 2019 09:10:52 +0100
Subject: [PATCH] C5 compatibility

---
 mpd-client.egg   |  8 ++++++++
 mpd-client.meta  | 10 ----------
 mpd-client.scm   | 22 +++++++++++-----------
 mpd-client.setup | 21 ---------------------
 4 files changed, 19 insertions(+), 42 deletions(-)
 create mode 100644 mpd-client.egg
 delete mode 100644 mpd-client.meta
 delete mode 100644 mpd-client.setup

diff --git a/mpd-client.egg b/mpd-client.egg
new file mode 100644
index 0000000..0bb6aea
--- /dev/null
+++ b/mpd-client.egg
@@ -0,0 +1,8 @@
+;;; mpd-client.meta -*- Scheme -*-
+
+((synopsis "Interface to Music Player Daemon")
+ (category sound)
+ (license "BSD")
+ (author "Hans Bulfone")
+ (dependencies regex)
+ (components (extension mpd-client (csc-options "-O2" "-d0"))))
diff --git a/mpd-client.meta b/mpd-client.meta
deleted file mode 100644
index 5d3823d..0000000
--- a/mpd-client.meta
+++ /dev/null
@@ -1,10 +0,0 @@
-;;; mpd-client.meta -*- Scheme -*-
-
-((egg "mpd-client.egg")
- (synopsis "Interface to Music Player Daemon")
- (category sound)
- (license "BSD")
- (author "Hans Bulfone")
- (needs regex)
- (files "mpd-client.meta" "mpd-client.setup" "mpd-client.scm"))
-
diff --git a/mpd-client.scm b/mpd-client.scm
index ae65180..702daa6 100644
--- a/mpd-client.scm
+++ b/mpd-client.scm
@@ -1,9 +1,6 @@
 ;; mpd-client.scm
 ;; client library for mpd (http://www.musicpd.org)
 
-; (define-extension mpd-client)
-(require-extension tcp regex srfi-1)
-
 (module mpd-client
   (;; mpd connection
    mpd-connection?
@@ -29,14 +26,17 @@
    ;; playback control
    play! pause! stop! next-song! previous-song!)
 
-  (import scheme chicken)
-  (import (only data-structures string-translate string-split)
-          (only extras read-line)
-          (only ports with-output-to-string)
-          (only regex regexp string-search)
-          (only tcp tcp-connect)
-          (only srfi-1 filter-map))
-  
+  (import scheme)
+  (import (chicken base))
+  (import (chicken condition))
+  (import (chicken io))
+  (import (chicken port))
+  (import (chicken string))
+  (import (chicken tcp))
+  (import (chicken time))
+  (import (only (srfi 1) filter-map))
+  (import (only regex regexp string-search))
+
   (define-record-type :mpd-conn
     (make-mpd-conn host port password i o version time)
     mpd-connection?
diff --git a/mpd-client.setup b/mpd-client.setup
deleted file mode 100644
index c73a996..0000000
--- a/mpd-client.setup
+++ /dev/null
@@ -1,21 +0,0 @@
-;;;; -*- Hen -*-
-
-(define (dynld-name fn)		
-  (make-pathname #f fn ##sys#load-dynamic-extension))	
-
-(compile -O2 -d0 -s mpd-client.scm -j mpd-client)
-(compile -O2 -d0 -s mpd-client.import.scm)
-
-(install-extension
-
-  ; Name of your extension:
-  'mpd-client
-
-  ; Files to install for your extension:
-  `(,(dynld-name "mpd-client") ,(dynld-name "mpd-client.import") )
-
-  ; Assoc list with properties for your extension:
-  `((version 1.13)
-    (documentation "mpd-client.html")
-    ))
-
-- 
2.21.0

