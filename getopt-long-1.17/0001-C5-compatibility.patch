From 9903a97d208f1da4230d0b9993f09a5762dddfb4 Mon Sep 17 00:00:00 2001
From: Vasilij Schneidermann <mail@vasilij.de>
Date: Sun, 12 Aug 2018 01:28:01 +0200
Subject: [PATCH] C5 compatibility

---
 getopt-long.egg   | 23 +++++++++++++++++++++++
 getopt-long.meta  | 27 ---------------------------
 getopt-long.scm   |  5 ++---
 getopt-long.setup | 20 --------------------
 tests/run.scm     |  3 ++-
 5 files changed, 27 insertions(+), 51 deletions(-)
 create mode 100644 getopt-long.egg
 delete mode 100644 getopt-long.meta
 delete mode 100644 getopt-long.setup

diff --git a/getopt-long.egg b/getopt-long.egg
new file mode 100644
index 0000000..31936f8
--- /dev/null
+++ b/getopt-long.egg
@@ -0,0 +1,23 @@
+;;;; -*- Hen -*-
+
+(; Your egg's license:
+
+ (license "LGPL-3")
+
+ ; Pick one from the list of categories (see below) for your egg and
+ ; enter it here.
+
+ (category misc)
+
+ ; A list of eggs getopt-long depends on.
+
+ (dependencies matchable)
+
+ (test-dependencies test)
+
+ (author "Ivan Raikov")
+
+ (synopsis "Command line option parsing.")
+
+ (components (extension getopt-long (csc-options "-O2" "-d0"))))
+
diff --git a/getopt-long.meta b/getopt-long.meta
deleted file mode 100644
index 6522d3a..0000000
--- a/getopt-long.meta
+++ /dev/null
@@ -1,27 +0,0 @@
-;;;; -*- Hen -*-
-
-((egg "getopt-long.egg") ; This should never change
-
- ; List here all the files that should be bundled as part of your egg.  
-
- (files "getopt-long.meta" "getopt-long.setup" "getopt-long.scm" "tests")
-
- ; Your egg's license:
-
- (license "LGPL-3")
-
- ; Pick one from the list of categories (see below) for your egg and
- ; enter it here.
-
- (category misc)
-
- ; A list of eggs getopt-long depends on.
-
- (needs matchable)
-
- (test-depends test)
-
- (author "Ivan Raikov")
-
- (synopsis "Command line option parsing."))
-
diff --git a/getopt-long.scm b/getopt-long.scm
index d15e0c0..a77795c 100644
--- a/getopt-long.scm
+++ b/getopt-long.scm
@@ -170,9 +170,8 @@
                      default-long-option-value-cset 
                      long-option-value-quoting)
 
-	(import scheme chicken)
-	
-	(require-extension data-structures srfi-1 srfi-13 srfi-14 matchable )
+	(import scheme (chicken base) (chicken string))
+        (import (srfi 1) (srfi 13) (srfi 14) matchable)
 
 
 (define (fetch-value kv) 
diff --git a/getopt-long.setup b/getopt-long.setup
deleted file mode 100644
index d166a10..0000000
--- a/getopt-long.setup
+++ /dev/null
@@ -1,20 +0,0 @@
-;;;; -*- Hen -*-
-
-(define (dynld-name fn)		
-  (make-pathname #f fn ##sys#load-dynamic-extension))	
-
-(compile -O2 -d0 -S -s getopt-long.scm -j getopt-long)
-(compile -O2 -d0 -s getopt-long.import.scm)
-
-(install-extension
-
-  ; Name of your extension:
-  'getopt-long
-
-  ; Files to install for your extension:
-  `(,(dynld-name "getopt-long") ,(dynld-name "getopt-long.import") )
-
-  ; Assoc list with properties for your extension:
-  `((version 1.17)
-    ))
-
diff --git a/tests/run.scm b/tests/run.scm
index 3f1e112..5a6a62a 100644
--- a/tests/run.scm
+++ b/tests/run.scm
@@ -1,5 +1,6 @@
 
-(require-extension srfi-13 posix test getopt-long matchable )
+(import scheme (chicken base) (chicken string) (chicken file posix)
+        (srfi 13) test getopt-long matchable)
 
 (define (symbol-upcase str)
   (string->symbol (string-upcase str)))
-- 
2.18.0

